<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- saved from url=(0074)https://www.mql5.com/en/code/viewcode/1397/128652/breakoutbarstrend_ea.mq5 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   
   <title>MQL5 Site / breakoutbarstrend_ea.mq5 - Free download of the 'Breakout Bars Trend EA' expert by 'Rone' for MetaTrader 5 in the MQL5 Code Base</title>
   <meta http-equiv="x-dns-prefetch-control" content="on">
   <link rel="dns-prefetch" href="https://c.mql5.com/">
       <link href="./MQL5 Site _ breakoutbarstrend_ea.mq5 - Free download of the &#39;Breakout Bars Trend EA&#39; expert by &#39;Rone&#39; for MetaTrader 5 in the MQL5 Code Base_files/core.3c698756a237769a724e13bfe97f39a2.css" type="text/css" rel="stylesheet" media="all">
    <link href="./MQL5 Site _ breakoutbarstrend_ea.mq5 - Free download of the &#39;Breakout Bars Trend EA&#39; expert by &#39;Rone&#39; for MetaTrader 5 in the MQL5 Code Base_files/all.352853ff9be6677e7bf86de69dd2955b.css" type="text/css" rel="stylesheet" media="all">
    <link href="./MQL5 Site _ breakoutbarstrend_ea.mq5 - Free download of the &#39;Breakout Bars Trend EA&#39; expert by &#39;Rone&#39; for MetaTrader 5 in the MQL5 Code Base_files/codebase.710a1c7c634c335587414fbd84b87a1e.css" type="text/css" rel="stylesheet" media="all">
    
   <style type="text/css">
     html {height:100%;min-height: 100%;}
     body {margin:0;padding:0;height: 100%;min-height: 100%;}
   </style>
<script type="text/javascript">  
  
  !function(){var n=!(window.mqGlobal={}),e=!1,o=[],i=[];function t(t){var n;for(n=0;n<t.length;n+=1)t[n]()}function d(){n||(n=!0,t(o),o=[])}function c(){d(),e||(e=!0,t(i),i=[])}if(mqGlobal.AddOnReady=function(t){n?t(document):o.push(t)},mqGlobal.AddOnLoad=function(t){e?t(document):i.push(t)},mqGlobal.AddOnActiveWindowChange=function(t){this._onvisibility||(this._onvisibility=[]),this._onvisibility[this._onvisibility.length]=t},document.addEventListener)document.addEventListener("DOMContentLoaded",d,!1),window.addEventListener("load",c,!1);else if(document.attachEvent&&(document.attachEvent("onreadystatechange",function(){switch(document.readyState){case"interactive":d();break;case"complete":c()}}),window.attachEvent("onload",c),document.documentElement.doScroll&&window==window.top)){!function n(){if(!called&&document.body)try{document.documentElement.doScroll("left"),d()}catch(t){setTimeout(n,0)}}()}}();
  mqGlobal.CookieDomain = ".mql5.com";
  mqGlobal.Language = 'en';
  mqGlobal.IsMobile = false;
      mqGlobal.ClearRteStorage = function (e) { if (window.GStorage || (window.GStorage = globalStorage(window.globalStorageDomain, window.globalStoragePage)), window.GStorage.supported) try { var o = e; window.GStorage.getItem("rte_autosave_uid", function (e, t) { t == o && (window.GStorage.removeItem("rte_autosave_text"), window.GStorage.removeItem("rte_autosave_date"), window.GStorage.removeItem("rte_autosave_uid")) }) } catch (e) { } };
</script>

</head>
<body cz-shortcut-listen="true">

<div style="height:100%;">
  <div class="code" id="code_content" style="left:5px;"><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BreakoutBarsTrend_EA.mq5 |</span><br><span class="comment">//|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copyright 2012, Rone. |</span><br><span class="comment">//|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rone.sergey@gmail.com |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="preprocessor">#property </span><span class="macro">copyright</span> <span class="string">"Copyright 2012, Rone."</span><br><span class="preprocessor">#property </span><span class="macro">link</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"rone.sergey@gmail.com"</span><br><span class="preprocessor">#property </span><span class="macro">version</span>&nbsp;&nbsp; <span class="string">"1.00"</span><br><span class="preprocessor">#property </span><span class="macro">description</span> <span class="string">"The Expert Advisor using the BreakoutBarsTrend_v2 indicator. Depending on the settings, the entry in market "</span><br><span class="preprocessor">#property </span><span class="macro">description</span> <span class="string">"is performed in the trend reversal ore after missing the specified number of "</span><br><span class="preprocessor">#property </span><span class="macro">description</span> <span class="string">"negative signals.\n"</span><br><span class="preprocessor">#property </span><span class="macro">description</span> <span class="string">"Important! If the reversal is specified in percentage, then the Delta, SL and TP also should be specified in percentage."</span><br><span class="preprocessor">#property </span><span class="macro">description</span> <span class="string">"If the reversal in pips - the Delta, SL and TP also are specified in pips."</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| includes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="preprocessor">#include </span>&lt;Trade\Trade.mqh&gt;<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| enums&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">enum</span> REVERSAL_MODE {<br>&nbsp;&nbsp; PIPS,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="comment">// In pips</span><br>&nbsp;&nbsp; PERCENT&nbsp;&nbsp;&nbsp;&nbsp; <span class="comment">// In percentage</span><br>};<br><span class="comment">//---</span><br><span class="keyword">enum</span> REVERSAL {<br>&nbsp;&nbsp; TO_DOWN = -<span class="number">1</span>,<br>&nbsp;&nbsp; NO_CHANGE = <span class="number">0</span>,<br>&nbsp;&nbsp; TO_UP = <span class="number">1</span><br>};<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| input parameters&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">input</span> REVERSAL_MODE&nbsp;&nbsp;InpReversal = PERCENT;&nbsp;&nbsp;<span class="comment">// Reversal</span><br><span class="keyword">input</span> <span class="keyword">double</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InpDelta = <span class="number">1.0</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="comment">// Delta</span><br><span class="keyword">input</span> <span class="keyword">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InpNegatives = <span class="number">1</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="comment">// Number of negative signals</span><br><span class="keyword">input</span> <span class="keyword">double</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InpStopLoss = <span class="number">1.0</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Stop Loss</span><br><span class="keyword">input</span> <span class="keyword">double</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InpTakeProfit = <span class="number">4.0</span>;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">// Take Profit</span><br><span class="keyword">input</span> <span class="keyword">double</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InpLot = <span class="number">1.0</span>;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="comment">// Lot</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| global variables&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">double</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delta;<br><span class="keyword">double</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stopLoss;<br><span class="keyword">double</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; takeProfit;<br><span class="keyword">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bbtHandle;<br><span class="keyword">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;negatives;<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Expert initialization function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">int</span> <span class="functions">OnInit</span>() {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">if</span> ( negatives &lt; <span class="number">0</span> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;negatives = <span class="number">0</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="functions">printf</span>(<span class="string">"The \"InpNegatives\" parameter is specified incorrectly: %d. the: %d. value will be used"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InpNegatives, negatives);<br>&nbsp;&nbsp; } <span class="keyword">else</span> {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;negatives = InpNegatives;<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; checkParameter(InpDelta, delta);<br>&nbsp;&nbsp; checkParameter(InpStopLoss, stopLoss);<br>&nbsp;&nbsp; checkParameter(InpTakeProfit, takeProfit);<br><span class="comment">//---</span><br>&nbsp;&nbsp; bbtHandle = <span class="indicators">iCustom</span>(<span class="predefines">_Symbol</span>, <span class="predefines">_Period</span>, <span class="string">"BreakoutBarsTrend_v2"</span>, InpReversal, delta, <span class="macro">false</span>, <span class="macro">false</span>, <span class="number">0</span>);<br>&nbsp;&nbsp; <span class="keyword">if</span> ( bbtHandle == <span class="macro">INVALID_HANDLE</span> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="functions">Print</span>(<span class="string">"Failed to create the BreakoutBarsTrend_v2 indicator. Error code: "</span>, <span class="functions">GetLastError</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>(-<span class="number">1</span>);<br>&nbsp;&nbsp; }&nbsp;&nbsp;<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">return</span>(<span class="number">0</span>);<br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Expert deinitialization function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">void</span> <span class="functions">OnDeinit</span>(<span class="keyword">const</span> <span class="keyword">int</span> reason) {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="functions">IndicatorRelease</span>(bbtHandle);<br><span class="comment">//---&nbsp;&nbsp; </span><br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Check parameter function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">void</span> checkParameter(<span class="keyword">double</span> inpValue, <span class="keyword">double</span> &amp;parameter) {<br>&nbsp;&nbsp; <span class="keyword">if</span> ( inpValue &lt; <span class="number">0.0</span> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> ( InpReversal == PIPS ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parameter = <span class="number">1000</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; parameter = <span class="number">1.0</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="functions">printf</span>(<span class="string">"The parameter is specified incorrectly: %f. the: %f. value will be used"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inpValue, parameter);<br>&nbsp;&nbsp; } <span class="keyword">else</span> {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parameter = inpValue;<br>&nbsp;&nbsp; }<br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Check volume value function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">double</span> checkVolumeValue(<span class="keyword">double</span> volume) {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">double</span> minVolume = <span class="functions">SymbolInfoDouble</span>(<span class="predefines">_Symbol</span>, <span class="macro">SYMBOL_VOLUME_MIN</span>);<br>&nbsp;&nbsp; <span class="keyword">double</span> maxVolume = <span class="functions">SymbolInfoDouble</span>(<span class="predefines">_Symbol</span>, <span class="macro">SYMBOL_VOLUME_MAX</span>);<br>&nbsp;&nbsp; <span class="keyword">double</span> volumeStep = <span class="functions">SymbolInfoDouble</span>(<span class="predefines">_Symbol</span>, <span class="macro">SYMBOL_VOLUME_STEP</span>);<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">if</span> ( volume &lt; minVolume ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volume = minVolume;<br>&nbsp;&nbsp; } <span class="keyword">else</span> <span class="keyword">if</span> ( volume &gt; maxVolume ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volume = maxVolume;<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">int</span> digits = (<span class="keyword">int</span>)<span class="functions">MathCeil</span>(<span class="functions">MathLog10</span>(<span class="number">1</span>/volumeStep));<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">return</span>(<span class="functions">NormalizeDouble</span>(volume, digits));<br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Get current time function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">datetime</span> getCurrentTime() {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">datetime</span> time[<span class="number">1</span>];<br>&nbsp;&nbsp; <span class="functions">CopyTime</span>(<span class="predefines">_Symbol</span>, <span class="predefines">_Period</span>, <span class="number">0</span>, <span class="number">1</span>, time);<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">return</span>(time[<span class="number">0</span>]);<br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Calculate and normalize SL/TP distance function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">double</span> calculateDistance(<span class="keyword">double</span> price, <span class="keyword">double</span> distance) {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">if</span> ( InpReversal == PIPS ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>(<span class="functions">NormalizeDouble</span>(distance*<span class="predefines">_Point</span>, <span class="predefines">_Digits</span>));<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; <span class="keyword">return</span>(<span class="functions">NormalizeDouble</span>((price/<span class="number">100</span>)*distance, <span class="predefines">_Digits</span>));<br><span class="comment">//---</span><br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Check if trend direction changed fucntion&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">int</span> checkTrendChange() {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">double</span> values[<span class="number">3</span>];<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; <span class="functions">ResetLastError</span>();<br>&nbsp;&nbsp; <span class="keyword">if</span> ( <span class="functions">CopyBuffer</span>(bbtHandle, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, values) != <span class="number">3</span> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="functions">Print</span>(<span class="string">"Indicator data copy error. Error #"</span>, <span class="functions">GetLastError</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>(NO_CHANGE);<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">if</span> ( values[<span class="number">0</span>] * values[<span class="number">1</span>] &lt; <span class="number">0</span> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> ( values[<span class="number">1</span>] &gt; <span class="number">0</span> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="keyword">return</span>(TO_UP);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="keyword">return</span>(TO_DOWN);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">return</span>(NO_CHANGE);<br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Check for close condition function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">void</span> checkForClose() {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">datetime</span> curTime = getCurrentTime();<br>&nbsp;&nbsp; <span class="keyword">static</span> <span class="keyword">datetime</span> prevTime;<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">if</span> ( curTime == prevTime ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">long</span> posType = <span class="functions">PositionGetInteger</span>(<span class="macro">POSITION_TYPE</span>);<br>&nbsp;&nbsp; <span class="keyword">int</span> reverse = checkTrendChange();<br>&nbsp;&nbsp; <span class="keyword">if</span> ( (posType == <span class="macro">POSITION_TYPE_BUY</span> &amp;&amp; reverse == TO_DOWN) || <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(posType == <span class="macro">POSITION_TYPE_SELL</span> &amp;&amp; reverse == TO_UP) ) <br>&nbsp;&nbsp; {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CTrade trade;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="functions">ResetLastError</span>();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> ( !trade.PositionClose(<span class="predefines">_Symbol</span>) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="functions">Print</span>(<span class="string">"Failed to close position. Error #"</span>, <span class="functions">GetLastError</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; prevTime = curTime;<br><span class="comment">//---</span><br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Check if previous trends were negatives function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">bool</span> isNegativeSeries() {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">int</span> size = negatives * <span class="number">100</span>;<br>&nbsp;&nbsp; <span class="keyword">double</span> close[], bbtValues[];<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; <span class="functions">ResetLastError</span>();<br>&nbsp;&nbsp; <span class="keyword">if</span> ( <span class="functions">CopyClose</span>(<span class="predefines">_Symbol</span>, <span class="predefines">_Period</span>, <span class="number">0</span>, size, close) != size ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="functions">Print</span>(<span class="string">"Failed to copy a history data. Error #"</span>, <span class="functions">GetLastError</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>(<span class="macro">false</span>);<br>&nbsp;&nbsp; }<br>&nbsp;&nbsp; <span class="keyword">if</span> ( <span class="functions">CopyBuffer</span>(bbtHandle, <span class="number">0</span>, <span class="number">0</span>, size, bbtValues) != size ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="functions">Print</span>(<span class="string">"Indicator data copy error. Error #"</span>, <span class="functions">GetLastError</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>(<span class="macro">false</span>);<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">double</span> firstPrice, result;<br>&nbsp;&nbsp; <span class="keyword">double</span> lastPrice = close[size-<span class="number">2</span>];<br>&nbsp;&nbsp; <span class="keyword">bool</span> up = (bbtValues[size-<span class="number">2</span>] &gt; <span class="number">0</span>) ? <span class="macro">false</span> : <span class="macro">true</span>;<br>&nbsp;&nbsp; <span class="keyword">int</span> counter = <span class="number">0</span>;<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; <span class="keyword">for</span> ( <span class="keyword">int</span> bar = size - <span class="number">3</span>; bar &gt; <span class="number">0</span>; bar-- ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> ( bbtValues[bar] * bbtValues[bar-<span class="number">1</span>] &lt; <span class="number">0</span> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; firstPrice = close[bar];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; result = (up) ? (lastPrice - firstPrice) : (firstPrice - lastPrice);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="keyword">if</span> ( result &gt; <span class="number">0.0</span> ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>(<span class="macro">false</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; counter += <span class="number">1</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="keyword">if</span> ( counter &gt;= negatives ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>(<span class="macro">true</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; up = !up;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; lastPrice = firstPrice;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">return</span>(<span class="macro">false</span>);<br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Check for open condition function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">void</span> checkForOpen() {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">datetime</span> curTime = getCurrentTime();<br>&nbsp;&nbsp; <span class="keyword">static</span> <span class="keyword">datetime</span> prevTime;<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">if</span> ( curTime == prevTime ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">int</span> reverse = checkTrendChange();<br>&nbsp;&nbsp; <br>&nbsp;&nbsp; <span class="keyword">if</span> ( reverse == NO_CHANGE ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;prevTime = curTime;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span>;<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">if</span> ( negatives == <span class="number">0</span> || (negatives &gt; <span class="number">0</span> &amp;&amp; isNegativeSeries()) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="macro">ENUM_ORDER_TYPE</span> type;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">double</span> price, sl, tp, volume;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">double</span> stopLevel = <span class="functions">SymbolInfoInteger</span>(<span class="predefines">_Symbol</span>, <span class="macro">SYMBOL_TRADE_STOPS_LEVEL</span>) * <span class="predefines">_Point</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CTrade trade;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//---</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> ( reverse == TO_UP ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type = <span class="macro">ORDER_TYPE_BUY</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; price = <span class="functions">SymbolInfoDouble</span>(<span class="predefines">_Symbol</span>, <span class="macro">SYMBOL_ASK</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sl = <span class="functions">MathMin</span>(price-calculateDistance(price, stopLoss), <span class="functions">SymbolInfoDouble</span>(<span class="predefines">_Symbol</span>, <span class="macro">SYMBOL_BID</span>)-stopLevel);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tp = <span class="functions">MathMax</span>(price+calculateDistance(price, takeProfit), price+stopLevel);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span class="keyword">else</span> {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; type = <span class="macro">ORDER_TYPE_SELL</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; price = <span class="functions">SymbolInfoDouble</span>(<span class="predefines">_Symbol</span>, <span class="macro">SYMBOL_BID</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sl = <span class="functions">MathMax</span>(price+calculateDistance(price, stopLoss), <span class="functions">SymbolInfoDouble</span>(<span class="predefines">_Symbol</span>, <span class="macro">SYMBOL_ASK</span>)+stopLevel);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tp = <span class="functions">MathMin</span>(price-calculateDistance(price, takeProfit), price-stopLevel);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//---</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volume = checkVolumeValue(InpLot);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> ( !trade.PositionOpen(<span class="predefines">_Symbol</span>, type, volume, price, sl, tp) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="functions">Print</span>(<span class="string">"Failed to open the order. Error #"</span>, <span class="functions">GetLastError</span>());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="keyword">return</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>&nbsp;&nbsp; prevTime = curTime;<br><span class="comment">//---</span><br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="comment">//| Expert tick function&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</span><br><span class="comment">//+------------------------------------------------------------------+</span><br><span class="keyword">void</span> <span class="functions">OnTick</span>() {<br><span class="comment">//---</span><br>&nbsp;&nbsp; <span class="keyword">if</span> ( <span class="functions">PositionSelect</span>(<span class="predefines">_Symbol</span>) ) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkForClose();<br>&nbsp;&nbsp; } <span class="keyword">else</span> {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkForOpen();<br>&nbsp;&nbsp; }<br><span class="comment">//---</span><br>}<br><span class="comment">//+------------------------------------------------------------------+</span><br></div>
</div>
<script src="./MQL5 Site _ breakoutbarstrend_ea.mq5 - Free download of the &#39;Breakout Bars Trend EA&#39; expert by &#39;Rone&#39; for MetaTrader 5 in the MQL5 Code Base_files/dalet.en.2a11b3cf98e4a4f6948524c303788cbf.js.download" type="text/javascript"></script>
    <script type="text/javascript">
  
  function coloriseBlock(text)
    {
     return(MQTE.Highlight('mql',text).value.replace(/\n/g,'<br>').replace(/  /g,"&nbsp;&nbsp;"));
    }
  
   mqGlobal.AddOnLoad(function()
    {
     var d = document.getElementById("code_content"),
         text = d.innerHTML.replace(/\<br\>/gi,"\n").replace(/&([#a-z0-9]+);/gi,
                       function (str,p)
                         {
                          switch(p.toUpperCase())
                            {
                             case 'AMP':
                               return '&';
                             case 'QUOT':
                               return '"';
                             case 'LT':
                               return '<';
                             case 'GT':
                               return '>';
                             case '#039':
                               return "'";
                             case 'NBSP':
                               return ' ';
                             }
                          return p;
                         }
                     );
     d.innerHTML = coloriseBlock(text);
    });

    function LoadCode(link) {
      Ajax.get(link.href, { tmp: Math.round(Math.random() * 10000) },
       {
         onready: function(text) {
           var d = document.getElementById("code_content");
           d.innerHTML = coloriseBlock(text);
           d = link.parentNode.firstChild;
           while (d) {
             if (d.nodeType == 1)
               {
                if (d == link) d.className = "attachItem selected";
                else d.className = "attachItem";
               }
             d = d.nextSibling;
           }
         },
         onerror: function() {

         }
       });
     return(false);
    }
</script>


       <script src="./MQL5 Site _ breakoutbarstrend_ea.mq5 - Free download of the &#39;Breakout Bars Trend EA&#39; expert by &#39;Rone&#39; for MetaTrader 5 in the MQL5 Code Base_files/all.185716abcf2df87165ad98fbfa470b78.js.download" type="text/javascript" defer="defer"></script>
    <script src="./MQL5 Site _ breakoutbarstrend_ea.mq5 - Free download of the &#39;Breakout Bars Trend EA&#39; expert by &#39;Rone&#39; for MetaTrader 5 in the MQL5 Code Base_files/articles.75d0460509f24a6dfcc04b552f9f06e7.js.download" type="text/javascript" defer="defer"></script>

   


<!-- Generated in 1.8757 ms --></body></html>